<div class="recipe-editor animate-up">
    <header class="mobile-nav">
        <button class="back-btn" routerLink="/dashboard">‚Üê</button>
        <h2>Nuevo Plato</h2>
        <div class="chef-icon">üë®‚Äçüç≥</div>
    </header>

    <form [formGroup]="recetaForm" (ngSubmit)="guardarReceta()" class="mobile-form">
        <div class="card header-card">
            <input type="text" formControlName="nombre" placeholder="Nombre del Plato">
            <div class="portion-counter">
                <label>Porciones</label>
                <div class="controls">
                    <button type="button" (click)="ajustarPorciones(-1)" [disabled]="porcionesActuales <= 1">-</button>
                    <span>{{ porcionesActuales }}</span>
                    <button type="button" (click)="ajustarPorciones(1)">+</button>
                </div>
            </div>
        </div>

        <div class="list-header">
            <h3>Ingredientes</h3>
            <button type="button" class="btn-add-pill" (click)="agregarIngrediente()">+ A√±adir</button>
        </div>

        <div formArrayName="ingredientes" class="ing-stack">
            @for (ing of ingredientes.controls; track $index) {
            <div [formGroupName]="$index" class="ing-card">
                <select formControlName="insumo_id" (change)="onIngredienteChange($index)">
                    <option value="">Elegir Insumo</option>
                    @for (i of insumosDisponibles; track i.id) {
                    <option [value]="i.id">{{ i.nombre }}</option>
                    }
                </select>
                <div class="ing-footer">
                    <div class="qty">
                        <input type="number" formControlName="cantidad" (input)="onIngredienteChange($index)">
                        <small>gr/ml</small>
                    </div>
                    <div class="price">S/ {{ ing.get('costo_parcial')?.value }}</div>
                    <button type="button" class="btn-del" (click)="removerIngrediente($index)">üóëÔ∏è</button>
                </div>
            </div>
            }
        </div>

        <footer class="floating-summary">
            <div class="costs">
                <div class="item">Total: <strong>S/ {{ costoTotalReceta | number:'1.2-2' }}</strong></div>
                <div class="item highlight">Por raci√≥n: <strong>S/ {{ (costoTotalReceta / porcionesActuales) | number:'1.2-2' }}</strong></div>
            </div>
            <button type="submit" [disabled]="recetaForm.invalid" class="btn-save btn-tap">Guardar Receta</button>
        </footer>
    </form>
</div>