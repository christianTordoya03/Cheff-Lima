<div class="mobile-inventory animate-up">
  <header class="inventory-header">
    <div class="header-content">
      <h1>Mi Despensa ü•¨</h1>
      <p>Gestiona precios y mermas reales</p>
    </div>
    <button class="btn-add-pill btn-tap" (click)="abrirFormulario()">+ Nuevo</button>
  </header>

  <div class="search-container">
    <input type="text" placeholder="Buscar insumo..." class="glass-input">
  </div>

  <div class="insumos-stack">
    @for (item of insumos; track item.id) {
      <div class="insumo-card glass-card">
        <div class="card-body">
            <div class="main-info">
              <span class="category-tag">{{ item.unidad_medida }}</span>
              <h3>{{ item.nombre }}</h3>
              <p class="merma-info">Rendimiento: <strong>{{ 100 - item.porcentaje_merma }}%</strong></p>
            </div>
            <div class="cost-display">
              <span class="price">S/ {{ item.costo_unitario_uso | number:'1.2-2' }}</span>
              <small>por {{ item.unidad_uso }}</small>
            </div>
          </div>
          <div class="card-actions">
            <button class="btn-icon edit" (click)="editarInsumo(item)">‚úèÔ∏è</button>
            <button class="btn-icon delete" (click)="eliminarInsumo(item.id!)">üóëÔ∏è</button>
          </div>
      </div>
    }
  </div>

  @if (mostrarFormulario) {
    <div class="form-overlay" (click)="cancelar()">
      <div class="bottom-sheet glass-card-heavy animate-slide-up" (click)="$event.stopPropagation()">
        <div class="drag-handle"></div>
        
        <header class="sheet-header">
          <h2>{{ esEdicion ? 'Editar Insumo' : 'Nuevo Insumo' }}</h2>
          <p>Calcula el costo real de tu materia prima</p>
        </header>

        <form [formGroup]="insumoForm" (ngSubmit)="guardarInsumo()">
          <div class="input-glass-group">
            <label>Nombre</label>
            <input type="text" formControlName="nombre" placeholder="Ej: Cebolla Roja">
          </div>

          <div class="row-grid">
            <div class="input-glass-group">
              <label>Precio Compra (S/)</label>
              <input type="number" formControlName="precio_compra" placeholder="0.00">
            </div>
            <div class="input-glass-group">
              <label>Medida</label>
              <select formControlName="unidad_medida">
                <option value="kg">Kilos</option>
                <option value="lt">Litros</option>
                <option value="und">Unid.</option>
              </select>
            </div>
          </div>

          <div class="input-glass-group">
            <label>Merma estimada (%)</label>
            <input type="number" formControlName="porcentaje_merma" placeholder="0">
          </div>

          <div class="form-actions">
            <button type="button" class="btn-ghost" (click)="cancelar()">Cancelar</button>
            <button type="submit" class="btn-primary-glow" [disabled]="insumoForm.invalid">
              {{ esEdicion ? 'Actualizar' : 'A√±adir a Despensa' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>